name: HLS

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:

  hls-test-suite:
    runs-on: ubuntu-22.04
    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: '0'

    # --------
    # Compile jlm with the HLS backend enabled
    # --------

    - name: "Build CIRCT"
      uses: ./.github/actions/BuildCirct
    - name: "Configure jlm"
      run: ./configure.sh --enable-asserts --enable-hls ${{ github.workspace }}/build-circt/circt --enable-verilator CXX=clang++-16
    - name: "Compile jlm"
      run: make -j `nproc` -O

    # --------
    # Run checks
    # --------

    - name: "Install verilator"
      run: sudo apt-get install verilator
    - name: "Run check"
      run: make -j `nproc` -O check
    - name: "Run check-verilator"
      run: make check-verilator
