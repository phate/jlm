name: macos

on:
  pull_request:
    branches: [ master ]

concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true

jobs:

  macos-build:
    runs-on: macos-14-large
    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: '0'
    - name: "Install Homebrew"
      run: |
        /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    - name: "Install LLVM and MLIR dependencies"
      run: |
        brew update
        brew install llvm@18
    - name: "Build jlm"
      run: |
        ./scripts/build-all.sh
